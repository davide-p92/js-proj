<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Quickstart Example 1</title>
    <link rel="icon" href="data:;base64,=">
    <style>
        /* Set editor dimensions */
        #editor {
            height: 500px;
            width: 50%;
        }

        /* Stretch editor to fit inside its containing div */
        .cm-editor {
            height: 100%;
            width: 100%;
        }
    </style>
</head>

<body>
    <button id="download-wat">Download .wat</button>
    <!-- Editor goes in here -->
    <div id="editor"></div>
    <script>
    	 let editorView;
	 document.getElementById("download-wat").addEventListener("click", ()=> {
		 const content = editorView.state.doc.toString();
		 const blob = new Blob([content], { type: 'text/plain' });
		 const a = document.createElement("a");
		 a.href = URL.createObjectURL(blob);
		 a.download = "program.wat";
		 a.click();
	 });
    </script>
    <!--CodeMirror 6 init-->
    <!-- CodeMirror 6 -->
    <script type="module" src="editor.js"></script>
    <script>
        // Create an initial state for the view
        window.addEventListener('DOMContentLoaded', () => {
        	const initialState = createEditorState(`(module
			(func $add (param $a i32) (param $b i32) (result i32)
   			   local.get $a
    			   local.get $b
    			   i32.add)
  			(export "add" (func $add))
		)`);
        	editorView = createEditorView(initialState, document.getElementById("editor"));

		//content to fill the downloaded wat file
		//const content = view.state.doc.toString();
        
		// Programmatically change editor contents
        	console.log("Before:\n", editorView.state.doc.toString())
        	editorView.dispatch({ changes: { from: 0, insert: ";; Your WAT file \n" } })
        	console.log("After:\n", editorView.state.doc.toString());
        });
    </script>
</body>

</html>
